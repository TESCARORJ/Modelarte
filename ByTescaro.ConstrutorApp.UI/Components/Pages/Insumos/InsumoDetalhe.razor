@page "/insumo/detalhes/{Id:long}"

@using ByTescaro.ConstrutorApp.Application.DTOs
@using ByTescaro.ConstrutorApp.Application.Utils @* Para EnumHelper, se usar para exibir o texto do enum *@
@using ByTescaro.ConstrutorApp.Domain.Enums
@using ByTescaro.ConstrutorApp.UI.Services
@using Radzen
@using Radzen.Blazor
@using Microsoft.AspNetCore.Authorization
@inject InsumoApiService InsumoApiService
@inject NavigationManager Navigation
@attribute [Authorize]

<PageTitle>Detalhes do Insumo</PageTitle>

<RadzenCard Class="rz-mt-5 rz-p-4 rz-shadow-md rz-rounded-md rz-mx-auto" Style="max-width: 900px; width: 100%;">
    <RadzenHeading Size="H4" Text="@Titulo" Class="rz-mb-3" /> @* Título dinâmico *@

    @if (insumo is null)
    {
        <RadzenText Text="Carregando detalhes do insumo ou insumo não encontrado." Style="color: gray; padding: 1rem;" />
        <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" Style="margin-top: 10px;" />
    }
    else
    {
        <RadzenFieldset Text="Identificação" Style="margin-bottom: 1.5rem;">
            <RadzenRow>
                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenText TextStyle="TextStyle.Body1">
                        <strong>Nome:</strong> <span>@insumo.Nome</span>
                    </RadzenText>
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenText TextStyle="TextStyle.Body1">
                        <strong>Unidade de Medida:</strong> <span>@(insumo.UnidadeMedida.HasValue? EnumHelper.ObterDescricaoEnum(insumo.UnidadeMedida.Value) : string.Empty)</span>
                    </RadzenText>
                </RadzenColumn>

                <RadzenColumn Size="12">
                    <RadzenText TextStyle="TextStyle.Body1">
                        <strong>Descrição:</strong> <span>@insumo.Descricao</span>
                    </RadzenText>
                </RadzenColumn>
            </RadzenRow>
        </RadzenFieldset>

        <RadzenFieldset Text="Dados de Auditoria" Style="margin-bottom: 1.5rem;">
            <RadzenRow>
                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenText TextStyle="TextStyle.Body1">
                        <strong>Usuário Cadastro:</strong> <span>@insumo.UsuarioCadastroNome</span> @* Assumindo que UsuarioCadastro é o nome do usuário *@
                    </RadzenText>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenText TextStyle="TextStyle.Body1">
                        <strong>Data/Hora Cadastro:</strong> <span>@insumo.DataHoraCadastro.ToString("dd/MM/yyyy HH:mm:ss")</span>
                    </RadzenText>
                </RadzenColumn>
              
            </RadzenRow>
        </RadzenFieldset>

        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="1rem" Class="rz-mt-3">
            <RadzenButton Text="Voltar"
                          ButtonStyle="ButtonStyle.Light"
                          Click="@(() => Navigation.NavigateTo("/insumos"))" />

            <RadzenButton Text="Editar"
                          Icon="edit"
                          ButtonStyle="ButtonStyle.Primary"
                          Click="@(() => Navigation.NavigateTo($"/insumo/editar/{insumo.Id}"))" />
        </RadzenStack>
    }
</RadzenCard>

@code {
    [Parameter] public long Id { get; set; }

    private InsumoDto? insumo;
    private string Titulo => $"Detalhes do Insumo: {insumo?.Nome ?? "Carregando..."}";

    protected override async Task OnInitializedAsync()
    {
        insumo = await InsumoApiService.GetByIdAsync(Id);
    }
}