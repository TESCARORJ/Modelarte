@page "/auditoria"
@using ByTescaro.ConstrutorApp.Application.DTOs
@using ByTescaro.ConstrutorApp.Application.Interfaces
@using ByTescaro.ConstrutorApp.Application.Utils
@using ByTescaro.ConstrutorApp.Domain.Entities
@using ByTescaro.ConstrutorApp.Domain.Enums
@using Microsoft.AspNetCore.Authorization
@inject ILogAuditoriaService LogService
@attribute [Authorize]

<RadzenCard Style="margin: 1rem;">
    <RadzenHeading Size="H5" Text="Registros de Auditoria" />

    <RadzenDataGrid TItem="LogAuditoriaDto" Data="@_logs" Class="mt-4"
                    AllowFiltering="true"
                    AllowColumnResize="true"
                    AllowSorting="true"
                    PageSize="10"
                    AllowPaging="true" 
                    PagerHorizontalAlign="HorizontalAlign.Left"
                    ShowPagingSummary="true"
                    FilterMode="FilterMode.Advanced"
                    Responsive="true"
                    ColumnWidth="300px">

        <Columns>
            <RadzenDataGridColumn TItem="LogAuditoriaDto" Property="Id" Title="ID" Width="80px" TextAlign="TextAlign.Center" />
            <RadzenDataGridColumn TItem="LogAuditoriaDto" Title="Data" Width="160px">
                <Template Context="log">
                    @log.DataHora.ToString("dd/MM/yyyy HH:mm")
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="LogAuditoriaDto" Property="UsuarioNome" Title="Usuário" />
            <RadzenDataGridColumn TItem="LogAuditoriaDto" Property="Entidade" Title="Entidade" TextAlign="TextAlign.Center" />
            <RadzenDataGridColumn TItem="LogAuditoriaDto" Title="Ação">
                <Template Context="e">
                    @EnumHelper.ObterDescricaoEnum(e.TipoLogAuditoria)
                </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="LogAuditoriaDto" Property="Descricao" Title="Descrição" Width="5000px" />
        </Columns>
    </RadzenDataGrid>
</RadzenCard>

@code {
    private List<LogAuditoriaDto> _logs = new();
    private List<EnumOption<TipoLogAuditoria>> tipoLogAuditoriaOptions = EnumHelper.ListarOpcoes<TipoLogAuditoria>(incluirNulo: true);


    protected override async Task OnInitializedAsync()
    {
        _logs = await LogService.ObterTodosAsync();
    }
}
