@page "/funcionarios/detalhes/{Id:long}"

@using ByTescaro.ConstrutorApp.Application.DTOs
@using ByTescaro.ConstrutorApp.Application.Utils
@using ByTescaro.ConstrutorApp.Domain.Enums
@using ByTescaro.ConstrutorApp.UI.Services
@using Microsoft.AspNetCore.Authorization
@using Radzen 
@using Radzen.Blazor 
@inject FuncionarioApiService FuncionarioApiService
@inject NavigationManager Navigation
@attribute [Authorize]

<PageTitle>Detalhes do Funcionário</PageTitle>

<RadzenCard Class="rz-mt-5 rz-p-4 rz-shadow-md rz-rounded-md rz-mx-auto" Style="max-width: 1300px; width: 100%;">
    <RadzenHeading Size="H4" Text="@Titulo" Class="rz-mb-3" /> @* Título dinâmico *@

    @if (funcionario is null)
    {
        <RadzenText Text="Carregando detalhes do funcionário ou funcionário não encontrado." Style="color: gray; padding: 1rem;" />
        <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" Style="margin-top: 10px;" />
    }
    else
    {
        <RadzenFieldset Text="Dados Pessoais" Style="margin-bottom: 1.5rem;">
            <RadzenRow>
                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenLabel Text="Nome" />
                    <RadzenTextBox Value="@funcionario.Nome" ReadOnly Style="width: 100%;" />
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="3">
                    <RadzenLabel Text="Função" />
                    <RadzenTextBox Value="@funcionario.FuncaoNome" ReadOnly Style="width: 100%;" />
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="3">
                    <RadzenLabel Text="Tipo de Pessoa" />
                    @* Exibe o texto amigável do enum *@
                    <RadzenTextBox Value="@(funcionario.TipoPessoa.HasValue ? EnumHelper.ObterDescricaoEnum(funcionario.TipoPessoa.Value) : string.Empty)" ReadOnly Style="width: 100%;" />
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="CPF/CNPJ" />
                    <RadzenTextBox Value="@funcionario.CpfCnpj" ReadOnly Style="width: 100%;" />
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Salário (R$)" />
                    @* Formata o salário como moeda *@
                    <RadzenTextBox Value="@(funcionario.Salario?.ToString("C2", System.Globalization.CultureInfo.CurrentCulture) ?? string.Empty)" ReadOnly Style="width: 100%;" />
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Data de Admissão" />
                    @* Formata a data *@
                    <RadzenTextBox Value="@(funcionario.DataAdmissao?.ToString("dd/MM/yyyy") ?? string.Empty)" ReadOnly Style="width: 100%;" />
                </RadzenColumn>

                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Data de Demissão" />
                    @* Formata a data e trata nulos *@
                    <RadzenTextBox Value="@(funcionario.DataDemissao?.ToString("dd/MM/yyyy") ?? "Não informado")" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
            </RadzenRow>
        </RadzenFieldset>

        <RadzenFieldset Text="Contato" Style="margin-bottom: 1.5rem;">
            <RadzenRow>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Telefone Principal" />
                    <RadzenTextBox Value="@funcionario.TelefonePrincipal" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="WhatsApp" />
                    <RadzenTextBox Value="@funcionario.TelefoneWhatsApp" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Email" />
                    <RadzenTextBox Value="@funcionario.Email" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
            </RadzenRow>
        </RadzenFieldset>

        <RadzenFieldset Text="Endereço" Style="margin-bottom: 1.5rem;">
            <RadzenRow>
                <RadzenColumn Size="12" SizeMD="3">
                    <RadzenLabel Text="CEP" />
                    <RadzenTextBox Value="@funcionario.CEP" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenLabel Text="Logradouro" />
                    <RadzenTextBox Value="@funcionario.Logradouro" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="3">
                    <RadzenLabel Text="Número" />
                    <RadzenTextBox Value="@funcionario.Numero" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Complemento" />
                    <RadzenTextBox Value="@funcionario.Complemento" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Bairro" />
                    <RadzenTextBox Value="@funcionario.Bairro" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenLabel Text="Cidade" />
                    <RadzenTextBox Value="@funcionario.Cidade" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="6">
                    <RadzenLabel Text="Estado" />
                    <RadzenTextBox Value="@funcionario.Estado" ReadOnly Style="width: 100%;" />
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="2">
                    <RadzenLabel Text="UF" />
                    <RadzenTextBox Value="@funcionario.UF" ReadOnly MaxLength="2" Style="width: 100%;" />
                </RadzenColumn>
            </RadzenRow>
        </RadzenFieldset>
        
        <RadzenDivider Style="margin: 2rem 0;" />

        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="1rem" Class="rz-mt-3">
            <RadzenButton Text="Voltar"
                          Click="@(() => Navigation.NavigateTo("/funcionarios"))"
                          ButtonStyle="ButtonStyle.Light" />

            <RadzenButton Text="Editar"
                          Icon="edit"
                          Click="@(() => Navigation.NavigateTo($"/funcionarios/editar/{funcionario.Id}"))"
                          ButtonStyle="ButtonStyle.Primary" />
        </RadzenStack>
    }
</RadzenCard>

@code {
    [Parameter] public long Id { get; set; }
    private FuncionarioDto? funcionario;

    // Título dinâmico
    private string Titulo => $"Detalhes do Funcionário: {funcionario?.Nome ?? "Carregando..."}";

    protected override async Task OnInitializedAsync()
    {
        funcionario = await FuncionarioApiService.GetByIdAsync(Id);
    }
}